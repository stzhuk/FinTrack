services:
  backend:
    command:
      [
        "uvicorn",
        "fintrack_backend.main:app",
        "--host",
        "0.0.0.0",
        "--port",
        "8000",
        "--reload",
        "--reload-dir",
        "/app/src",
      ]
    environment:
      PYTHONPATH: /app/src
    volumes:
      - ./backend/src:/app/src
      - ./backend/migrations:/app/migrations
      - ./backend/alembic.ini:/app/alembic.ini
      - ./backend/tests:/app/tests

  frontend:
    user: "0:0"
    command:
      [
        "sh",
        "-c",
        "if [ ! -x node_modules/.bin/next ]; then npm ci; fi && npm run dev -- --hostname 0.0.0.0 --port 3000",
      ]
    environment:
      NODE_ENV: development
      WATCHPACK_POLLING: "true"
      NEXT_TELEMETRY_DISABLED: "1"
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-http://localhost:8000/api}
    volumes:
      - ./frontend:/app
      - frontend_node_modules:/app/node_modules

volumes:
  frontend_node_modules:
